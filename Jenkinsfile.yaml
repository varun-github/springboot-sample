pipeline:
  agent: any
  environment:
    ENV1: VAL1
    ENV2: VAL2
  # parameters:
  #   - "string(name: 'STRING_PARAM', defaultValue: 'DefaultValue', description: 'Description')"
  #   - "text(name: 'TEXT_PARAM', defaultValue: 'DefaultValue', description: 'Description')"
  options:
    - "timeout(time: 1, unit: 'HOURS')"
    - skipDefaultCheckout()
  stages:
    - stage: Basic Stage
      steps:
        - echo "Basic Stage"
    - stage: "Prerequisites"
      steps:
        script:
          - echo "Basic Stage - Script"
    - stage: "Build"
      agent:
        any:
      tools:
        - maven: 'Maven 3.3.9'
          jdk: 'jdk8'
      environment:
        - JAVA_HOME: /opt/apps/jdk/11/11.2.1
          MAVEN_HOME: /opt/apps/maven/3.8.1
          credentialsId: 'stash-jenkins-access-key'
      steps: |
        mvn -DskipTests=true -s /opt/build_settings/maven/maven_jfrog_settings.xml clean package
      post:
        always:
          - echo "Build Completed"
        failure:
          - /opt/bin/cloud_studio_telemetry send_error ${STACK_TRACE}
        success:
          - /opt/bin/cloud_studio_telemetry send_success 
      options:
        - skipDefaultCheckout()
      # tools:
      #   jdk: default
      steps:
        - echo "Complex Stage"
    - stage: "Stage MultiLine String"
      steps: |
        echo "1"
        echo "2"
        echo "3"
    - stage: "Stage MultiLine Script"
      steps:
        script: |
          echo "1"
          echo "2"
          echo "3"
    - stage: "Stage - When"
      when:
        - branch 'production'
        - "environment name: 'DEPLOY_TO', value: 'production'"
      steps:
        - echo "Stage When"
    - stage: "Stage - When- BeforeAgent"
      when:
        - "branch 'production'"
      beforeAgent: true
      steps:
        - echo "Stage When"
    - stage: "Stage - When- Conditional"
      when:
        anyOf:
          allOf:
            - "branch 'production'"
      steps:
        - echo "Stage When - Conditional"
    - stage: "Sequential Stage"
      stages:
        - stage: "Sequential Stage1"
          steps:
            - echo "Sequential Stage1"
        - stage: "Sequential Stage2"
          steps:
            - "echo 'test'"
    - stage: "Parallel Stage"
      failFast: true
      parallel:
        - stage: "Parallel Stage1"
          steps:
            - echo "Parallel Stage1"
        - stage: "Parallel Stage2"
          steps:
            - echo "Parallel Stage2"
    - stage: "WithEnv Stage"
      steps:
        script:
          - withEnv: "['MYKEY1=MYVAL1']"
            script:
              - echo env.MYKEY1
    - stage: "WithEnv Interwined"
      steps:
        script:
          - withEnv: "['KEY1=VAL1']"
            script:
              - echo env.KEY1
              - withEnv: "['KEY2=VAL2']"
                script:
                  - echo env.KEY2
  post:
    always:
      script:
        - echo "Post Always - Script"
    changed:
      - echo "Post Changed - Step"
