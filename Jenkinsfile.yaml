pipeline:
  agent: any
  options:
  - buildDiscarder(logRotator(numToKeepStr:'10'))
  - 'timeout(time: 1, unit: ''HOURS'')'
  stages:
  - environment:
      BUILD_ENV: DEVELOPMENT
      JAVA_HOME: /opt/apps/jdk/11/11.2.1
    post:
      always:
      - echo 'mandatory'
      failure:
      - echo 'failure'
      success:
      - echo 'success'
    stage: Build Java Springboot App
    steps:
      script:
      - 'utils.withMaven do: "package", withArgFile: ".jenkins/stage.build.env.json"'
  - stage: Create Docker Image
    steps:
      script:
      - 'utils.withDocker do: "build", withArgFile: ".jenkins/stage.build.docker.env.json"'
  - stage: Deploy to AWS Fargate
    steps:
      script:
      - 'utils.withTerraform do: "fargateDeploy", withArgFile: ".jenkins/stage.terraform.fargate_deploy_vars.json"'
